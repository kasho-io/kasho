<div className="container mx-auto px-4 py-8 max-w-4xl">

# Architecture Overview

Kasho is designed as a distributed system for real-time database replication using PostgreSQL's logical replication features.

## System Components

<div className="mockup-code mb-6">
  <pre data-prefix="1"><code>{`PostgreSQL Primary ──┐`}</code></pre>
  <pre data-prefix="2"><code>{`                    ├──> pg-change-stream ──> Redis`}</code></pre>
  <pre data-prefix="3"><code>{`                    │                           │`}</code></pre>
  <pre data-prefix="4"><code>{`                    │                           v`}</code></pre>
  <pre data-prefix="5"><code>{`                    └──> pg-translicator <─────┘`}</code></pre>
  <pre data-prefix="6"><code>{`                              │`}</code></pre>
  <pre data-prefix="7"><code>{`                              v`}</code></pre>
  <pre data-prefix="8"><code>{`                        PostgreSQL Replica`}</code></pre>
</div>

## Core Services

### pg-change-stream

The change capture service that:
- Connects to PostgreSQL using logical replication
- Decodes WAL (Write-Ahead Log) messages
- Publishes changes to Redis as events

### pg-translicator

The replication service that:
- Subscribes to change events from Redis
- Transforms and validates changes
- Applies changes to target databases

### Redis

Acts as the message broker:
- Provides pub/sub messaging
- Enables horizontal scaling
- Buffers changes during peak loads

## Data Flow

1. **Change Detection**: PostgreSQL records all changes in its WAL
2. **Change Capture**: pg-change-stream reads the WAL using logical replication
3. **Event Publishing**: Changes are published to Redis as structured events
4. **Event Consumption**: pg-translicator subscribes to relevant events
5. **Change Application**: Events are transformed and applied to target databases

## Scalability

<div className="stats shadow">
  <div className="stat">
    <div className="stat-title">Horizontal Scaling</div>
    <div className="stat-value">✓</div>
    <div className="stat-desc">Multiple translicators can process events</div>
  </div>
  
  <div className="stat">
    <div className="stat-title">High Throughput</div>
    <div className="stat-value">10k+</div>
    <div className="stat-desc">Changes per second</div>
  </div>
  
  <div className="stat">
    <div className="stat-title">Low Latency</div>
    <div className="stat-value">&lt;100ms</div>
    <div className="stat-desc">End-to-end replication time</div>
  </div>
</div>

</div>